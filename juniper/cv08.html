
<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8. cvičení.md</title>
    <link rel="stylesheet" href="../styly.css">
</head>
<body class="stackedit">
    <div class="stackedit__html">
        <h1>Firewall</h1>
<h2>Packet mode VS Flow mode</h2>
<p><img alt="firewall_modes" src="./src/firewall_modes.png" /></p>
<h2>Packet mode</h2>
<h3>Nastavení Packet módu z Flow módu</h3>
<pre><code class="language-console"># delete security
</code></pre>
<pre><code class="language-console"># set security forwarding-options family inet mode packet-based
</code></pre>
<pre><code class="language-console"># set security forwarding-options family inet6 mode packet-based
</code></pre>
<pre><code class="language-console"># set security forwarding-options family mpls mode packet-based
</code></pre>
<pre><code class="language-console">&gt; show security flow status
</code></pre>
<h3>Firewall filter</h3>
<pre><code class="language-console"># show filter
</code></pre>
<pre><code class="language-json">family inet {
    filter filter-in {
        term discard-icmp {
            from {
                source-address {
                    1.2.3.4/32;
                }
                destination-address {
                    5.6.7.8/32;
                }
                protocol icmp;
            }
            then {
                reject;
            }
        }
        term permit-others {
            then accept;
        }
    }
}
</code></pre>
<h3>Firewall filter - interface</h3>
<pre><code class="language-console"># show interfaces ge-0/0/9
</code></pre>
<pre><code class="language-json">unit 0 {
    family inet {
        filter {
            input filter-in;
        }
        address 10.45.28.9/24;
    }
}
</code></pre>
<h3>Firewall filter - monitoring</h3>
<pre><code class="language-console"># show firewall
</code></pre>
<pre><code class="language-console"># show firewall filter &lt;filter-name&gt;
</code></pre>
<h2>Flow mode</h2>
<h3>Nastavení Flow módu z Packet módu</h3>
<pre><code class="language-console"># delete security
</code></pre>
<pre><code class="language-console"># set security forwarding-options family inet mode flow-based
</code></pre>
<pre><code class="language-console"># set security forwarding-options family inet6 mode flow-based
</code></pre>
<pre><code class="language-console"># set security forwarding-options family mpls mode flow-based
</code></pre>
<pre><code class="language-console">&gt; show security flow status
</code></pre>
<h3>Security - zones</h3>
<pre><code class="language-console"># delete security
</code></pre>
<pre><code class="language-console"># show security zones
</code></pre>
<pre><code class="language-json">security-zone &lt;zone-name&gt; {
    interfaces {
        &lt;interface-name&gt; {
            host-inbound-traffic {
                system-services {
                    &lt;service&gt;
                }
                protocols {
                    &lt;protocol&gt;
                }
            }
        }
    }
}
</code></pre>
<h3>Security - policy</h3>
<pre><code class="language-console"># show security policies
</code></pre>
<pre><code class="language-json">from-zone &lt;zone-name&gt; to-zone &lt;zone-name&gt; {
    policy &lt;policy-name&gt; {
        match {
            source-address &lt;src-address&gt;;
            destination-address &lt;dst-address&gt;;
            application &lt;app-name&gt;;
        }
        then {
            &lt;action&gt;;
        }
    }
}
</code></pre>
<h3>Monitoring</h3>
<pre><code class="language-console"># show security flow session
</code></pre>
<pre><code class="language-console"># show security flow session source-prefix &lt;prefix&gt;
</code></pre>
<pre><code class="language-console"># show security flow statistics
</code></pre>
<pre><code class="language-console"># show security policies
</code></pre>
<pre><code class="language-console"># show security policies from-zone &lt;zone&gt; to zone &lt;zone&gt;
</code></pre>
<h1>RPF</h1>
<p>RPF je zkratka pro <strong>Reverse Path Forwarding</strong> (česky <strong>Zpětné směrování cestou</strong>). Jde o techniku používanou primárně pro zvýšení bezpečnosti sítě a je klíčová pro fungování <strong>Multicastu</strong>.</p>
<h2>RPF v Kontextu Bezpečnosti (Unicast RPF - uRPF)</h2>
<ul>
<li>V kontextu <strong>Unicast</strong> (běžného) provozu se RPF používá jako <strong>bezpečnostní mechanismus k zabránění IP spoofingu</strong>.</li>
</ul>
<h3>Jak uRPF funguje?</h3>
<ol>
<li>
<p>Router obdrží IP paket.</p>
</li>
<li>
<p>Zkontroluje <strong>zdrojovou IP adresu</strong> (Source IP Address) v hlavičce paketu.</p>
</li>
<li>
<p>Využije svou <strong>směrovací tabulku (FIB)</strong>, aby určil, kudy by měl paket se <strong>stejnou</strong> zdrojovou adresou <strong>opustit</strong> síť, pokud by byl odesílán lokálně.</p>
</li>
<li>
<p>Porovná toto zjištěné <strong>výstupní rozhraní</strong> s <strong>rozhraním, na kterém paket skutečně přišel</strong> (vstupní rozhraní).</p>
<ul>
<li>
<p><strong>Pravidlo:</strong> Pokud by nejlepší cesta k dosažení zdrojové IP adresy vedla <strong>zpět</strong> přes rozhraní, ze kterého paket přišel, <strong>RPF kontrola projde</strong> (paket je legitimní).</p>
</li>
<li>
<p>Pokud by nejlepší cesta k dosažení zdrojové IP adresy vedla <strong>jinudy</strong> (např. ven do internetu nebo přes jiný port), <strong>RPF kontrola selže</strong> (paket je považován za zfalšovaný/spoofed) a <strong>paket je zahozen</strong>.</p>
</li>
</ul>
</li>
</ol>
<h3>Cíle uRPF:</h3>
<ul>
<li>
<p><strong>Zabrání IP Spoofingu:</strong> Útočníci nemohou předstírat, že pocházejí z adresy, ke které router nemá platnou cestu vedoucí zpět přes daný vstupní port.</p>
</li>
<li>
<p><strong>Zmírnění DoS/DDoS:</strong> Pomáhá zastavit šíření útoků, které používají zfalšované zdrojové adresy (např. útoky typu <strong>Smurf</strong>).</p>
</li>
</ul>
<h2>RPF v Kontextu Multicastu</h2>
<ul>
<li>V kontextu <strong>Multicast</strong> provozu (např. protokol PIM) je RPF <strong>zásadní pro vytvoření stromu distribuce dat</strong> (Multicast Distribution Tree) a pro <strong>zajištění loop-free (bezsmyčkového) šíření dat</strong>.</li>
</ul>
<h3>Jak RPF funguje u Multicastu?</h3>
<ol>
<li>
<p>Router obdrží Multicast paket určený pro skupinu G ze zdroje S.</p>
</li>
<li>
<p>Zkontroluje <strong>zdrojovou IP adresu</strong> (S).</p>
</li>
<li>
<p>Využije svou <strong>Unicast směrovací tabulku</strong> (FIB), aby zjistil, jaká je <strong>nejlepší cesta zpět ke zdroji S</strong>.</p>
</li>
<li>
<p>Pokud paket přišel na rozhraní, které je na <strong>nejlepší (nejkratší)</strong> cestě ke zdroji S, <strong>RPF kontrola projde</strong>.</p>
<ul>
<li>Router poté paket <strong>přepošle</strong> na všechna ostatní rozhraní, kde jsou přihlášeni příjemci skupiny G.</li>
</ul>
</li>
<li>
<p>Pokud paket přišel na <strong>jiné rozhraní</strong> (např. delší nebo vedlejší cesta), <strong>RPF kontrola selže</strong> (indikuje smyčku nebo neoptimální tok) a <strong>paket je zahozen</strong>.</p>
</li>
</ol>
<h3>Cíle RPF v Multicastu:</h3>
<ul>
<li>
<p><strong>Bezsmyčkové Šíření:</strong> RPF zajišťuje, že Multicast provoz teče pouze po jedné, optimální cestě, čímž se zabrání nekonečným smyčkám.</p>
</li>
<li>
<p><strong>Vytvoření Distribučního Stromu:</strong> RPF definuje <strong>cestu od zdroje</strong> (Source Path) a tím pádem i <strong>kořen</strong> (Root) distribučního stromu, což je klíčové pro všechny Multicast směrovací protokoly.</p>
</li>
</ul>
<h2>Konfigurace</h2>
<pre><code class="language-console"># show interface ge-0/0/9
</code></pre>
<pre><code class="language-json">ge-0/0/9 {
    unit 0 {
        family inet {
            rpf-check;
            address 12.34.56.78/29;
        }
    }
}
</code></pre>
<pre><code class="language-console"># show interface ge-0/0/9 extensive
</code></pre>
    </div>
</body>
</html>
